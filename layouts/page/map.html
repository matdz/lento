<!DOCTYPE HTML>

<html>
<head>
    {{ partial "header.html" . }}
  </head>
  <body>
    <div class="container">

      <div class="row">
        <div class="three columns">
          <a class="title" href="/">Matteo takes Photos</a>
        </div>
      </div>

      <div class="row">
        <div class="three columns left-side">
          {{ partial "nav.html"}}
          {{ partial "tag-list.html"}}
        </div>
        <div class="nine columns right-side">
        <div id="my-map" class="left-0 top-0 vh-100 w-100" style="width: 1000px; height: 500px;"></div>
        </div>
      </div>
    </div>
    


<script type="text/javascript">
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const paramCenter = urlParams.get('c');
    const paramZoom = urlParams.get('z');

    var myAPIKey = "1c13a6f47cf74818b03d23cda6cfadb8";

    var map = new maplibregl.Map({
        container: 'my-map',
        style: `https://maps.geoapify.com/v1/styles/osm-bright/style.json?apiKey=${myAPIKey}`,
        attributionControl: false,
        zoomControl: false,
    });
    var nav = new maplibregl.NavigationControl({ showCompass: false });
    map.addControl(nav, 'top-left');
    map.addControl(new maplibregl.AttributionControl({
        compact: true,
    }), 'bottom-right');

    var locations = [{"ID":"093a604e","Name":"093a604e","Latitude":-5.892858,"Longitude":39.354553},{"ID":"3560bae9","Name":"3560bae9","Latitude":-3.155542,"Longitude":35.622350},{"ID":"4f07bd8a","Name":"4f07bd8a","Latitude":-3.155081,"Longitude":35.621525},{"ID":"6d0fbccb","Name":"6d0fbccb","Latitude":-3.787050,"Longitude":36.038611},{"ID":"835f0aea","Name":"835f0aea","Latitude":-3.160811,"Longitude":35.629550},{"ID":"8fdf4d3f","Name":"8fdf4d3f","Latitude":-3.779986,"Longitude":35.996353},{"ID":"9c54e7ff","Name":"9c54e7ff","Latitude":-3.154922,"Longitude":35.621331},{"ID":"f44d6adb","Name":"f44d6adb","Latitude":-3.155503,"Longitude":35.621925}];
    for (let i = 0; i < locations.length; i++) {
        var marker = new maplibregl.Marker()
            .setLngLat([locations[i].Longitude, locations[i].Latitude])
            .setPopup(new maplibregl.Popup({ closeButton: false }).setHTML(
                '<p><a href="/img/' + locations[i].Name.toString() + '">' + locations[i].ID + '</a></p>'
            ))
            .addTo(map);
    }


    if (paramZoom != null) {
        map.setZoom(parseFloat(paramZoom));
    }
    if (paramCenter != null) {
        var values = paramCenter.split(",");
        map.setCenter({ lat: parseFloat(values[0]), lon: parseFloat(values[1])});
    }

    var currentBounds = map.getBounds();
    var urlBounds = map.getBounds();
    map.on('move', function() { currentBounds = map.getBounds(); });
    map.on('zoom', function() { currentBounds = map.getBounds(); });

    setInterval(function () {
      if (currentBounds == urlBounds) {
          return
      }
      var {lng, lat} = map.getCenter();
      history.replaceState(
          null,
          "",
          window.location.origin +
            window.location.pathname +
            "?c=" +
            lat.toString() +
            "," +
            lng.toString() +
            "&z=" +
            map.getZoom().toString()
      )
      urlBounds = currentBounds;
    },500);
</script>

<script src="/js/index.min.4c78ca53e81faeffb29ab94c80f4f644f2df563529863bee158b5c34489c39bd.js" defer></script>

  </body>
</html>

